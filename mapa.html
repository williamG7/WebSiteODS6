<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Mapa de Vertidos</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map("map").setView([41.3851, 2.1734], 8); // Centre en Catalunya

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution:
        '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    }).addTo(map);

    fetch("http://localhost:3000/vertidos")
      .then((response) => response.json())
      .then((data) => {
        data.forEach((vertido) => {
          if (vertido.Latitud && vertido.Longitud) {
            const marker = L.marker([vertido.Latitud, vertido.Longitud]).addTo(map);
            const perillos = vertido["Matèria Perillosa"] ? "Sí" : "No";
            marker.bindPopup(`
              <b>Municipi:</b> ${vertido["Terme municipal"]}<br/>
              <b>Tipus:</b> ${vertido.Tipus}<br/>
              <b>Perillós:</b> ${perillos}
            `);
          }
        });
      })
      .catch((error) => {
        console.error("Error carregant dades de vertits:", error);
      });
  </script>
</body>
</html>
